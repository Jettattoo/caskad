<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cascade Server - –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 10px 10px 0 0; }
        .content { padding: 20px; }
        .btn { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #2980b9; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; }
        .cascade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .cascade-item:hover { background: #f8f9fa; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #ecf0f1; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-card h3 { font-size: 2em; color: #2c3e50; margin-bottom: 10px; }
        .alert { padding: 15px; border-radius: 5px; margin: 10px 0; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üöÄ Cascade Server - –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è</h1>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞–º–∏ –ø–ª–∞—Ç–µ–∂–µ–π (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞!)</p>
                </div>
                <div style="text-align: right;">
                    <div id="userInfo" style="margin-bottom: 10px;">
                        <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        <span id="userRole" style="opacity: 0.8; margin-left: 10px;"></span>
                    </div>
                    <button class="btn btn-danger" onclick="logout()" style="padding: 8px 15px; font-size: 14px;">
                        –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalCascades">0</h3>
                    <p>–í—Å–µ–≥–æ –∫–∞—Å–∫–∞–¥–æ–≤</p>
                </div>
                <div class="stat-card">
                    <h3 id="activeCascades">0</h3>
                    <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalBalance">0 ‚ÇΩ</h3>
                    <p>–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="openCreateModal()">‚ûï –°–æ–∑–¥–∞—Ç—å –∫–∞—Å–∫–∞–¥</button>
                <button class="btn" onclick="loadCascades()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn" onclick="exportData()">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn" onclick="importData()">üìÅ –ò–º–ø–æ—Ä—Ç</button>
                <button class="btn" onclick="openUsersModal()" id="usersBtn" style="display: none;">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Å–∫–∞–¥–æ–≤ -->
            <div id="cascadesList">
                <div class="alert alert-error">–ù–µ—Ç –∫–∞—Å–∫–∞–¥–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–∞—Å–∫–∞–¥.</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="modal" id="cascadeModal">
        <div class="modal-content">
            <h3 id="modalTitle">–°–æ–∑–¥–∞—Ç—å –∫–∞—Å–∫–∞–¥</h3>
            <form id="cascadeForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞ *</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label>API –∫–ª—é—á *</label>
                    <input type="text" id="apiKey" required>
                </div>
                <div class="form-group">
                    <label>URL –∑–∞–ø—Ä–æ—Å–∞ *</label>
                    <input type="url" id="requestUrl" required>
                </div>
                <div class="form-group">
                    <label>Callback URL</label>
                    <input type="url" id="callbackUrl">
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <input type="number" id="priority" min="1" max="10" value="1">
                </div>
                <div class="form-group">
                    <label>–ë–∞–ª–∞–Ω—Å</label>
                    <input type="number" id="balance" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø API</label>
                    <select id="apiType">
                        <option value="default">Default</option>
                        <option value="payShark">PayShark</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="active" checked> –ê–∫—Ç–∏–≤–Ω—ã–π
                    </label>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h3>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
            <form id="loginForm">
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">–í–æ–π—Ç–∏</button>
                </div>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                <h4>–î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç—ã:</h4>
                <p><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:</strong> admin / admin123</p>
                <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> user / user123</p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="modal" id="usersModal">
        <div class="modal-content" style="max-width: 800px;">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="openCreateUserModal()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>
            <div id="usersContent" style="max-height: 400px; overflow-y: auto;">
                <div class="alert">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <h3 id="userModalTitle">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <form id="userForm">
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                    <input type="text" id="userUsername" required>
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å *</label>
                    <input type="password" id="userPassword" required>
                </div>
                <div class="form-group">
                    <label>–ü–æ–ª–Ω–æ–µ –∏–º—è *</label>
                    <input type="text" id="userFullName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label>–†–æ–ª—å *</label>
                    <select id="userRole" required>
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="userActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π
                    </label>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeUserModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport()">

    <script>
        let cascades = JSON.parse(localStorage.getItem('cascades') || '[]');
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        let currentCascadeId = null;
        let currentUserId = null;
        let currentUser = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (users.length === 0) {
            users = [
                {
                    id: 'admin_1',
                    username: 'admin',
                    password: 'admin123',
                    role: 'admin',
                    email: 'admin@cascade.local',
                    fullName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    active: true,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'user_1',
                    username: 'user',
                    password: 'user123',
                    role: 'user',
                    email: 'user@cascade.local',
                    fullName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    active: true,
                    createdAt: new Date().toISOString()
                }
            ];
            localStorage.setItem('users', JSON.stringify(users));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function checkAuth() {
            currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                document.getElementById('loginModal').style.display = 'block';
                return;
            }
            
            updateUserInfo();
            loadCascades();
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.fullName || currentUser.username;
                document.getElementById('userRole').textContent = `(${currentUser.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'})`;
                
                if (currentUser.role === 'admin') {
                    document.getElementById('usersBtn').style.display = 'inline-block';
                }
            }
        }

        // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password && u.active);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                document.getElementById('loginModal').style.display = 'none';
                updateUserInfo();
                loadCascades();
                updateStats();
                showAlert('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
            } else {
                showAlert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!', 'error');
            }
        });

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginModal').style.display = 'block';
            document.getElementById('usersBtn').style.display = 'none';
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Å–∫–∞–¥–æ–≤
        function loadCascades() {
            const container = document.getElementById('cascadesList');
            
            if (cascades.length === 0) {
                container.innerHTML = '<div class="alert alert-error">–ù–µ—Ç –∫–∞—Å–∫–∞–¥–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–∞—Å–∫–∞–¥.</div>';
                return;
            }

            container.innerHTML = cascades.map(cascade => `
                <div class="cascade-item">
                    <div>
                        <strong>${cascade.name}</strong><br>
                        <small>${cascade.requestUrl} | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${cascade.priority} | ${cascade.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</small>
                    </div>
                    <div>
                        <strong>${cascade.balance} ‚ÇΩ</strong><br>
                        <button class="btn" onclick="editCascade('${cascade.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteCascade('${cascade.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            updateStats();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const total = cascades.length;
            const active = cascades.filter(c => c.active).length;
            const balance = cascades.reduce((sum, c) => sum + (c.balance || 0), 0);
            
            document.getElementById('totalCascades').textContent = total;
            document.getElementById('activeCascades').textContent = active;
            document.getElementById('totalBalance').textContent = balance.toLocaleString() + ' ‚ÇΩ';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveCascades() {
            localStorage.setItem('cascades', JSON.stringify(cascades));
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞
        function openCreateModal() {
            currentCascadeId = null;
            document.getElementById('modalTitle').textContent = '–°–æ–∑–¥–∞—Ç—å –∫–∞—Å–∫–∞–¥';
            document.getElementById('cascadeForm').reset();
            document.getElementById('cascadeModal').style.display = 'block';
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞
        function editCascade(id) {
            const cascade = cascades.find(c => c.id === id);
            if (cascade) {
                currentCascadeId = id;
                document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥';
                document.getElementById('name').value = cascade.name;
                document.getElementById('apiKey').value = cascade.apiKey;
                document.getElementById('requestUrl').value = cascade.requestUrl;
                document.getElementById('callbackUrl').value = cascade.callbackUrl || '';
                document.getElementById('priority').value = cascade.priority;
                document.getElementById('balance').value = cascade.balance;
                document.getElementById('apiType').value = cascade.apiType;
                document.getElementById('active').checked = cascade.active;
                document.getElementById('cascadeModal').style.display = 'block';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞
        document.getElementById('cascadeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                id: currentCascadeId || 'cascade_' + Date.now(),
                name: document.getElementById('name').value,
                apiKey: document.getElementById('apiKey').value,
                requestUrl: document.getElementById('requestUrl').value,
                callbackUrl: document.getElementById('callbackUrl').value,
                priority: parseInt(document.getElementById('priority').value),
                balance: parseFloat(document.getElementById('balance').value),
                apiType: document.getElementById('apiType').value,
                active: document.getElementById('active').checked,
                createdAt: currentCascadeId ? cascades.find(c => c.id === currentCascadeId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            if (currentCascadeId) {
                const index = cascades.findIndex(c => c.id === currentCascadeId);
                cascades[index] = data;
            } else {
                cascades.push(data);
            }

            saveCascades();
            loadCascades();
            closeModal();
            showAlert('–ö–∞—Å–∫–∞–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–∞
        function deleteCascade(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Å–∫–∞–¥?')) {
                cascades = cascades.filter(c => c.id !== id);
                saveCascades();
                loadCascades();
                showAlert('–ö–∞—Å–∫–∞–¥ —É–¥–∞–ª–µ–Ω!', 'success');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('cascadeModal').style.display = 'none';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const data = {
                cascades: cascades,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cascades-export.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }

        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.cascades && Array.isArray(data.cascades)) {
                        cascades = data.cascades;
                        saveCascades();
                        loadCascades();
                        showAlert('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                    } else {
                        showAlert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!', 'error');
                    }
                } catch (error) {
                    showAlert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞!', 'error');
                }
            };
            reader.readAsText(file);
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.style.minWidth = '300px';
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        function openUsersModal() {
            if (currentUser.role !== 'admin') {
                showAlert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!', 'error');
                return;
            }
            document.getElementById('usersModal').style.display = 'block';
            loadUsers();
        }

        function closeUsersModal() {
            document.getElementById('usersModal').style.display = 'none';
        }

        function loadUsers() {
            const container = document.getElementById('usersContent');
            
            if (users.length === 0) {
                container.innerHTML = '<div class="alert alert-error">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="cascade-item">
                    <div>
                        <strong>${user.fullName || user.username}</strong><br>
                        <small>${user.email} | ${user.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'} | ${user.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</small>
                    </div>
                    <div>
                        <button class="btn" onclick="editUser('${user.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-danger" onclick="deleteUser('${user.id}')" 
                                ${user.id === currentUser.id ? 'disabled' : ''}>üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function openCreateUserModal() {
            currentUserId = null;
            document.getElementById('userModalTitle').textContent = '–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
            document.getElementById('userForm').reset();
            document.getElementById('userModal').style.display = 'block';
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                currentUserId = id;
                document.getElementById('userModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userPassword').value = '';
                document.getElementById('userPassword').placeholder = '–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å';
                document.getElementById('userFullName').value = user.fullName;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role;
                document.getElementById('userActive').checked = user.active;
                document.getElementById('userModal').style.display = 'block';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                id: currentUserId || 'user_' + Date.now(),
                username: document.getElementById('userUsername').value,
                password: document.getElementById('userPassword').value,
                fullName: document.getElementById('userFullName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value,
                active: document.getElementById('userActive').checked,
                createdAt: currentUserId ? users.find(u => u.id === currentUserId).createdAt : new Date().toISOString()
            };

            if (currentUserId) {
                const index = users.findIndex(u => u.id === currentUserId);
                if (data.password) {
                    users[index] = data;
                } else {
                    // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                    users[index] = { ...users[index], ...data };
                    delete users[index].password;
                }
            } else {
                users.push(data);
            }

            localStorage.setItem('users', JSON.stringify(users));
            loadUsers();
            closeUserModal();
            showAlert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        });

        function deleteUser(id) {
            if (id === currentUser.id) {
                showAlert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è!', 'error');
                return;
            }
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                users = users.filter(u => u.id !== id);
                localStorage.setItem('users', JSON.stringify(users));
                loadUsers();
                showAlert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω!', 'success');
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            const modal = document.getElementById('cascadeModal');
            const loginModal = document.getElementById('loginModal');
            const usersModal = document.getElementById('usersModal');
            const userModal = document.getElementById('userModal');
            
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === loginModal) {
                // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
            }
            if (event.target === usersModal) {
                closeUsersModal();
            }
            if (event.target === userModal) {
                closeUserModal();
            }
        }
    </script>
</body>
</html>
